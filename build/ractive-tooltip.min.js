/* ractive-tooltip 2014-10-23 */
(function(){var a=[].slice,b={}.hasOwnProperty;!function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p;return d=c.Ractive,"undefined"==typeof d?(h="Please install Ractive [http://www.ractivejs.org/]",void console.error(h)):(i=function(){var c,d,e,f;for(f=arguments[0],e=2<=arguments.length?a.call(arguments,1):[];d=e.shift();)for(c in d)b.call(d,c)&&(f[c]=d[c]);return f},o=document.createElement("div").style,p=["moz","webkit","o","ms"],k={},m=function(a){var b,c,d;if(a=f(a),!k[a])if("undefined"!=typeof o[a])k[a]=a;else for(b=a.charAt(0).toUpperCase()+a.substring(1),c=venders.length;c--;)if(d=p[c],"undefined"!=typeof o[d+b]){k[a]=d+b;break}return k[a]},f=function(a){return a.replace(/-([a-zA-Z])/g,function(a,b){return b.toUpperCase()})},j=function(a,b){var c,d,e;return d=window.getComputedStyle(a),c=m(b),e=d.getPropertyValue(c)||d[c],"0px"===e&&(e=0),e},l=function(a,b,c){return a.style[m(b)]=c,a},g=function(b,c){var e;return e=function(){var b,c,d,e,f;return b=1<=arguments.length?a.call(arguments,0):[],e={top:0,left:0,height:0,width:0,bottom:0,right:0,_isRect:!0},b.length<3?b[0]._isRect?e=b[0].r:(d="string"==typeof b[0]?document.querySelector(b[0]):b[0],f=d.getBoundingClientRect(),c="BODY"===d.tagName,e.marginTop=parseFloat(j(d,"margin-top"))||0,e.marginLeft=parseFloat(j(d,"margin-left"))||0,e.top=f.top,e.left=f.left,b[1]||(e.top-=e.marginTop,e.left-=e.marginLeft),e.scroll=c?document.documentElement.scrollTop||document.body.scrollTop:d.scrollTop,e.height=c?window.innerHeight||document.documentElement.clientHeight:d.offsetHeight,e.width=c?window.innerWidth||document.documentElement.clientWidth:d.offsetWidth):(e.top=b[0],e.left=b[1],e.height=b[2],e.width=b[3]),e.right=e.left+e.width,e.bottom=e.top+e.height,e},new d({el:c.viewport,debug:c.debug,append:!0,template:c.template,computed:{arrowPositionLeft:"Math.round(50 - ((${viewportOffsetDelta.left} / ${tooltipRect.width}) * 100))",arrowPositionTop:"Math.round(50 - ((${viewportOffsetDelta.top} / ${tooltipRect.height}) * 100))",arrowStyle:"${viewportOffsetDelta.left} ? 'left:' + ${arrowPositionLeft} + '%' : ${viewportOffsetDelta.top} ? 'top:' + ${arrowPositionTop} + '%' : ''",tooltipPositionLeft:"${tooltipPosition.left} + ${viewportOffsetDelta.left}",tooltipPositionRight:"${tooltipPosition.top}  + ${viewportOffsetDelta.top}",tooltipStyle:"'left:' + ${tooltipPositionLeft} + 'px;top:' + ${tooltipPositionRight} + 'px;opacity:' + ${tooltipOpacity}"},data:{hidden:!0,options:c,targetRect:e(b,!0),tooltipOpacity:0,tooltipRect:{top:0,left:0,height:0,width:0},tooltipPosition:{top:0,left:0},viewportOffsetDelta:{top:0,left:0},placement:"top"},interpolators:{"float":function(a,b){var c,d,e,f;return e=parseFloat(a),f=parseFloat(b),isNaN(e||isNaN(f))?null:(c=Math.abs(f-e),d=f>e,.01>=c?function(){return b}:function(b){return d||(b=-b),a+b*c})}},_scrollAdjustedTargetRect:function(){var a,b,c;return c=this.data.viewportRect,b=this.data.targetRect,a=e(b,!0),a.top-=c.scroll,a.bottom-=c.scroll,a},getViewportOffsetDelta:function(){var a,b,c,d,e,f,g,h;switch(h=this.get("viewportRect"),f=this.get("tooltipRect"),e=this.get("tooltipPosition"),b={top:0,left:0},e.placement){case"top":case"bottom":c=e.left,d=e.right,c<h.left?b.left=h.left-c:d>h.width&&(b.left=h.right-d);break;case"left":case"right":g=e.top-h.scroll,a=e.top+h.scroll+f.height,g<h.top?b.top=h.top-g:a>h.bottom&&(b.top=h.bottom-a)}return b},getTooltipPosition:function(a){var b,d,f,g,h,i,j,k;return a||(a=function(){return!0}),c=this.get("options"),h=this.get("targetRect"),i=this.get("tooltipRect"),k=this.get("viewportRect"),b=this.nodes.raTooltip.querySelector(".ra-tooltip-arrow"),j=c.viewport||"body",g=c.placement,d=!1,/\bauto\b/.test(g)&&(g=g.replace(/\s*\bauto\b\s*/,""),g||(g="top"),d=!0),f=function(b){return function(){var d,e,f,j,k,l,m;return m=function(){return h.top-i.height-c.offsetY},k=function(){return h.left-i.width-c.offsetX},d=function(){return h.bottom+c.offsetY},l=function(){return h.right+c.offsetX},e=function(){return h.left+Math.floor(h.width/2)-Math.floor(i.width/2)},f=function(){return h.top+Math.floor(h.height/2)-Math.floor(i.height/2)},j=function(){switch(g){case"left":return{top:f(),left:k()};case"right":return{top:f(),left:l()};case"top":return{top:m(),left:e()};case"top-right":return{top:m(),left:l()};case"top-left":return{top:m(),left:k()};case"bottom":return{top:d(),left:e()};case"bottom-right":return{top:d(),left:l()};case"bottom-left":return{top:d(),left:k()}}}(),j.placement=g,a.call(b,j)}}(this),this.set("placement",g,function(){var a,b,j,l,m;return i=e(this.nodes.raTooltip),k=e(c.viewport,!0),d?(m=g,a=function(){return h.bottom+i.height-k.scroll>k.height},l=function(){return h.top-k.scroll-i.height<0},j=function(){return h.right+i.width>k.width},b=function(){return h.left-i.width<k.left},g=function(){switch(g){case"bottom":return a()?"top":g;case"top":return l()?"bottom":g;case"right":return j()?"left":g;case"left":return b()?"right":g;case"bottom-left":return a()||b()?"top-right":g;case"bottom-right":return a()||j()?"top-left":g;case"top-left":return l()||b()?"bottom-right":g;case"top-right":return l()||j()?"bottom-left":g;default:return g}}(),this.set("placement",g,f)):f()})},pointIntersectsTarget:function(a,c){var d;return d=e(b,!0),a<d.left||c<d.top||a>d.right||c>d.bottom?!1:!0},show:function(){var a;return this.set("viewportRect",e(this.data.options.viewport,!0)),this.set("targetRect",e(b,!0)),this.set("tooltipRect",e(this.nodes.raTooltip)),a=new d.Promise(function(a){return this.getTooltipPosition(function(b){return this.set("tooltipPosition",b,function(){return this.set("tooltipRect",e(this.nodes.raTooltip)),this.set("viewportOffsetDelta",this.getViewportOffsetDelta(),function(b){return function(){return b.animate("tooltipOpacity",1,{duration:b.data.options.showAnimationDuration,easing:"linear",interpolator:"float",complete:function(c,d){return b.set("hidden",!1),a([c,d])}})}}(this))})})})},hide:function(){return this.animate("tooltipOpacity",0,{duration:this.data.options.hideAnimationDuration,easing:"linear",interpolator:"float",complete:function(a){return function(){return a.set("hidden",!0)}}(this)})},setContent:function(a){return this.get("hidden")?this.hide().then(function(b){return function(){return b.set("options.content",a),b.show()}}(this)):this.set("options.content",a)}})},n='<div id="raTooltip" style="{{tooltipStyle}}" class="ra-tooltip {{placement}}">\n  <div class="ra-tooltip-inner">\n    {{{options.content}}}\n  </div>\n  <div class="ra-tooltip-arrow" style="{{arrowStyle}}"></div>\n</div>',e=function(){function a(a,b,c){var d;return this.node=a,2===arguments.length&&(c=b,b="default"),(d=this.constructor.options)[b]||(d[b]={}),this.options=i({},this.constructor.options["default"],this.constructor.options[b]),this.options.content=c,this.windowMousemoveHandler=this.windowMousemoveHandler.bind(this),this.nodeMousemoveHandler=this.nodeMousemoveHandler.bind(this),this.node.addEventListener("mousemove",this.nodeMousemoveHandler,!1),this.tooltipView=g(this.node,this.options),this}return a.options={"default":{debug:!1,template:n,placement:"auto top",offsetX:0,offsetY:0,timeout:1e4,delay:500,viewport:"body",hideAnimationDuration:200,showAnimationDuration:200}},a.prototype.mouseIsOver=!1,a.prototype.rendered=!1,a.prototype.options=null,a.prototype.delayTimer=null,a.prototype.timeoutTimer=null,a.prototype.node=null,a.prototype.tooltipView=null,a.prototype.teardown=function(){return window.removeEventListener("mousemove",this.windowMousemoveHandler),this.node.removeEventListener("mousemove",this.nodeMouseoverHandler,!1),this.tooltipView.teardown()},a.prototype.windowMousemoveHandler=function(a){return this.mouseIsOver?this.tooltipView.pointIntersectsTarget(a.pageX,a.pageY)?void 0:this.mouseleave(a):void 0},a.prototype.nodeMousemoveHandler=function(a){this.resetTimers(),this.rendered?this.showTimeout():(this.mouseIsOver||this.mouseenter(a),this.delayTimeout().then(function(a){return function(){return a.showTimeout(),a.show()}}(this)))},a.prototype.mouseenter=function(){return this.mouseIsOver=!0,window.addEventListener("mousemove",this.windowMousemoveHandler,!1)},a.prototype.mouseleave=function(){return this.mouseIsOver=!1,window.removeEventListener("mousemove",this.windowMousemoveHandler,!1),this.resetTimers(),this.hide()},a.prototype.resetTimers=function(){this.timeoutTimer&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null),this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null)},a.prototype.delayTimeout=function(){var a;return a=new d.Promise(function(a){return this.options.delay?this.delayTimer=setTimeout(function(){return function(){return a()}}(this),this.options.delay):a()})},a.prototype.showTimeout=function(){this.options.timeout&&(this.timeoutTimer=setTimeout(function(a){return function(){return a.rendered&&a.mouseIsOver?a.mouseleave():void 0}}(this),this.options.timeout))},a.prototype.hide=function(){return this.rendered=!1,this.tooltipView.hide()},a.prototype.show=function(){return this.rendered=!0,this.tooltipView.show()},a}(),"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):c.TooltipDecorator=e)}("undefined"==typeof window?this:window)}).call(this);